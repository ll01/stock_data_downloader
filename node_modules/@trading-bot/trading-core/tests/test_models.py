"""Tests for the models module."""

import pytest
from datetime import datetime
from trading_core.models import CandleData, Trade, PairData, TickerStats


def test_candle_data():
    """Test the CandleData class."""
    # Create a CandleData instance
    timestamp = datetime(2023, 7, 17, 12, 0, 0)
    candle = CandleData(
        timestamp=timestamp,
        ticker="AAPL",
        open=150.0,
        high=155.0,
        low=149.0,
        close=153.0,
        volume=1000000.0
    )
    
    # Verify attributes
    assert candle.timestamp == timestamp
    assert candle.ticker == "AAPL"
    assert candle.open == 150.0
    assert candle.high == 155.0
    assert candle.low == 149.0
    assert candle.close == 153.0
    assert candle.volume == 1000000.0
    
    # Test default value for volume
    candle_no_volume = CandleData(
        timestamp=timestamp,
        ticker="AAPL",
        open=150.0,
        high=155.0,
        low=149.0,
        close=153.0
    )
    assert candle_no_volume.volume == 0.0


def test_trade():
    """Test the Trade class."""
    # Create a Trade instance with all attributes
    timestamp = datetime(2023, 7, 17, 12, 0, 0)
    trade = Trade(
        pair_id=1,
        id="trade123",
        ticker="AAPL",
        quantity=10.0,
        price=153.0,
        side="buy",
        timestamp=timestamp,
        closed=False
    )
    
    # Verify attributes
    assert trade.pair_id == 1
    assert trade.id == "trade123"
    assert trade.ticker == "AAPL"
    assert trade.quantity == 10.0
    assert trade.price == 153.0
    assert trade.side == "buy"
    assert trade.timestamp == timestamp
    assert trade.closed is False
    
    # Test with minimal required attributes
    minimal_trade = Trade(pair_id=2)
    assert minimal_trade.pair_id == 2
    assert minimal_trade.id is None
    assert minimal_trade.ticker is None
    assert minimal_trade.quantity is None
    assert minimal_trade.price is None
    assert minimal_trade.side is None
    assert minimal_trade.timestamp is None
    assert minimal_trade.closed is False


def test_pair_data():
    """Test the PairData class."""
    # Create a PairData instance
    timestamp = datetime(2023, 7, 17, 12, 0, 0)
    pair = PairData(
        ticker1="AAPL",
        ticker2="MSFT",
        cointegration_score=0.95,
        p_value=0.01,
        half_life=5.0,
        correlation=0.8,
        created_at=timestamp
    )
    
    # Verify attributes
    assert pair.ticker1 == "AAPL"
    assert pair.ticker2 == "MSFT"
    assert pair.cointegration_score == 0.95
    assert pair.p_value == 0.01
    assert pair.half_life == 5.0
    assert pair.correlation == 0.8
    assert pair.created_at == timestamp
    
    # Test default value for created_at
    pair_no_timestamp = PairData(
        ticker1="AAPL",
        ticker2="MSFT",
        cointegration_score=0.95,
        p_value=0.01,
        half_life=5.0,
        correlation=0.8
    )
    assert isinstance(pair_no_timestamp.created_at, datetime)


def test_ticker_stats():
    """Test the TickerStats class."""
    # Create a TickerStats instance with all attributes
    timestamp = datetime(2023, 7, 17, 12, 0, 0)
    stats = TickerStats(
        ticker="AAPL",
        mean=150.0,
        std_dev=5.0,
        min=140.0,
        max=160.0,
        last_price=153.0,
        last_updated=timestamp,
        kappa=1.5,
        theta=0.04,
        xi=0.3,
        rho=-0.7,
        omega=0.000002,
        alpha=0.1,
        beta=0.85,
        initial_variance=0.0004,
        degrees_of_freedom=5.0
    )
    
    # Verify attributes
    assert stats.ticker == "AAPL"
    assert stats.mean == 150.0
    assert stats.std_dev == 5.0
    assert stats.min == 140.0
    assert stats.max == 160.0
    assert stats.last_price == 153.0
    assert stats.last_updated == timestamp
    assert stats.kappa == 1.5
    assert stats.theta == 0.04
    assert stats.xi == 0.3
    assert stats.rho == -0.7
    assert stats.omega == 0.000002
    assert stats.alpha == 0.1
    assert stats.beta == 0.85
    assert stats.initial_variance == 0.0004
    assert stats.degrees_of_freedom == 5.0
    
    # Test with minimal required attributes
    minimal_stats = TickerStats(
        ticker="AAPL",
        mean=150.0,
        std_dev=5.0,
        min=140.0,
        max=160.0,
        last_price=153.0,
        last_updated=timestamp
    )
    assert minimal_stats.ticker == "AAPL"
    assert minimal_stats.kappa is None
    assert minimal_stats.theta is None
    assert minimal_stats.xi is None
    assert minimal_stats.rho is None
    assert minimal_stats.omega is None
    assert minimal_stats.alpha is None
    assert minimal_stats.beta is None
    assert minimal_stats.initial_variance is None
    assert minimal_stats.degrees_of_freedom is None